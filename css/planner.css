function attachButtonToggle(btn) {
    btn.addEventListener("click", () => {
        btn.classList.toggle("selected");
    });
}

document.querySelectorAll(".attraction-btn").forEach(attachButtonToggle);

const attractionContainer = document.querySelector(".attraction-buttons");
const customInputContainer = document.querySelector(".custom-attractions");

function createNewInput() {
    const input = document.createElement("input");
    input.type = "text";
    input.id = "custom-attraction-input";
    input.placeholder = "Add your own destination and press Enter";
    input.style.padding = "10px 15px";
    input.style.fontSize = "14px";
    input.style.border = "2px dashed #26A69A";
    input.style.borderRadius = "6px";
    input.style.minWidth = "120px";
    input.style.boxSizing = "border-box";
    input.style.textAlign = "center";

    input.addEventListener("keypress", handleCustomInput);
    customInputContainer.appendChild(input);
    input.focus();
}

function handleCustomInput(e) {
    if (e.key === "Enter") {
        const value = e.target.value.trim();
        if (value === "") return;

        const newBtn = document.createElement("button");
        newBtn.type = "button";
        newBtn.classList.add("attraction-btn", "selected");
        newBtn.textContent = value;

        attachButtonToggle(newBtn);

        attractionContainer.appendChild(newBtn);

        e.target.remove();

        createNewInput();
    }
}

const firstInput = document.getElementById("custom-attraction-input");
if (firstInput) {
    firstInput.addEventListener("keypress", handleCustomInput);
}

const generateBtn = document.getElementById("generate-plan");
const userPlanDiv = document.getElementById("user-plan");

generateBtn.addEventListener("click", () => {
    const numDays = parseInt(document.getElementById("num-days").value);

    const selectedAttractions = Array.from(document.querySelectorAll(".attraction-btn.selected"))
        .map(btn => btn.textContent);

    if (!numDays || selectedAttractions.length === 0) {
        userPlanDiv.innerHTML = "<p style='color:red;'>Please select days and at least one attraction!</p>";
        return;
    }

    userPlanDiv.innerHTML = ""; // Clear previous plan

    for (let day = 1; day <= numDays; day++) {
        const dayAttractions = selectedAttractions.filter((_, i) => i % numDays === (day - 1));

        const dayCard = document.createElement("div");
        dayCard.classList.add("day-card");

        const dayHeader = document.createElement("h3");
        dayHeader.textContent = `Day ${day}`;
        dayCard.appendChild(dayHeader);

        if (dayAttractions.length > 0) {
            const ul = document.createElement("ul");
            dayAttractions.forEach(attraction => {
                const li = document.createElement("li");
                li.textContent = attraction;
                ul.appendChild(li);
            });
            dayCard.appendChild(ul);
        } else {
            const p = document.createElement("p");
            p.textContent = "No attractions planned.";
            dayCard.appendChild(p);
        }

        userPlanDiv.appendChild(dayCard);
    }
});
